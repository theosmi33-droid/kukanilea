import requests

URL = "http://127.0.0.1:5051/api/chat"

def test_tenant_breach():
    print("--- Red-Team: Cross-Tenant Breach ---")
    
    # Simulate a request where the attacker tries to force a tenant context
    # by spoofing cookies or session data (if possible)
    print("Trying to access data with spoofed tenant cookie...")
    
    # We try to use a tenant name that shouldn't be accessible
    cookies = {"tenant_id": "STOLEN_TENANT"}
    resp = requests.post(URL, json={"q": "Wer bin ich?"}, cookies=cookies)
    
    print(f"Response status: {resp.status_code}")
    # The system should either ignore the spoofed cookie or reject it
    # KUKANILEA uses session-based tenant isolation, so cookie spoofing shouldn't work.
    
    if "STOLEN_TENANT" in resp.text:
        print("[FAIL] Tenant context hijacked!")
    else:
        print("[OK] Tenant isolation held firm.")

if __name__ == "__main__":
    test_tenant_breach()
