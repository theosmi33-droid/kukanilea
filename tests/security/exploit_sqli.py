import sys
from pathlib import Path

# Add project root to path
sys.path.append(str(Path(__file__).parent.parent.parent))

from app.agents import retrieval_fts


def test_sqli():
    print("--- Red-Team: SQL-Injection (OCR) ---")

    # Malicious string often used to break queries
    evil_input = "'; DROP TABLE users; --"

    print(f"Injecting: {evil_input}")

    try:
        # Search is usually where injections happen
        results = retrieval_fts.search(evil_input)
        print("[OK] Query executed without crash.")
        print(f"     Results found: {len(results)}")
    except Exception as e:
        print(f"[FAIL] Query crashed: {e}")


if __name__ == "__main__":
    test_sqli()
