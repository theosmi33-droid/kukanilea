<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>KUKANILEA · COMMAND CENTER</title>
    <script src="{{ url_for('static', filename='vendor/tailwindcss.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/htmx.min.js') }}"></script>
</head>
<body class="bg-slate-950 text-slate-200 font-mono p-8">
    <!-- Header -->
    <div class="flex justify-between items-center mb-12 border-b border-slate-800 pb-6">
        <div class="flex items-center gap-4">
            <div class="bg-orange-600 w-10 h-10 rounded flex items-center justify-center animate-pulse">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" stroke-width="2"></path></svg>
            </div>
            <h1 class="text-xl font-black tracking-widest text-orange-500 uppercase">KUKANILEA · Maschinenraum</h1>
        </div>
        <div class="text-[10px] text-slate-500 text-right">
            <div>VERSION: 1.4.0-COMMERCIAL</div>
            <div>STATUS: SECURE MESH</div>
        </div>
    </div>

    <!-- Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
        <!-- DB Card -->
        <div hx-get="/dev/dashboard/metrics/db" hx-trigger="load, every 5s" hx-swap="outerHTML">
            <div class="bg-slate-900 border border-slate-800 p-6 rounded-xl animate-pulse">Lade DB...</div>
        </div>
        <!-- RAG Card -->
        <div hx-get="/dev/dashboard/metrics/rag" hx-trigger="load, every 5s" hx-swap="outerHTML">
            <div class="bg-slate-900 border border-slate-800 p-6 rounded-xl animate-pulse">Lade RAG...</div>
        </div>
        <!-- AI Card -->
        <div hx-get="/dev/dashboard/metrics/ai" hx-trigger="load, every 5s" hx-swap="outerHTML">
            <div class="bg-slate-900 border border-slate-800 p-6 rounded-xl animate-pulse">Lade AI...</div>
        </div>
        <!-- System Card -->
        <div hx-get="/dev/dashboard/metrics/system" hx-trigger="load, every 5s" hx-swap="outerHTML">
            <div class="bg-slate-900 border border-slate-800 p-6 rounded-xl animate-pulse">Lade HW...</div>
        </div>
    </div>

    <!-- Actions Section -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Rebuild Index Card -->
        <div class="bg-slate-900 border border-slate-800 p-6 rounded-xl shadow-2xl">
            <h2 class="text-xs font-bold text-slate-400 uppercase mb-4 tracking-tighter flex items-center gap-2">
                <span class="w-2 h-2 bg-indigo-500 rounded-full"></span>
                RAG Maintenance
            </h2>
            <div class="space-y-4">
                <p class="text-[10px] text-slate-500">Baut den semantischen Vektor-Index (sqlite-vec) für alle Wissensartikel und Belege neu auf.</p>
                <button hx-post="/dev/dashboard/rebuild-index" hx-swap="innerHTML" hx-target="#rebuild-result" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded text-[10px] uppercase transition-all">
                    Index Neu Aufbauen
                </button>
                <div id="rebuild-result" class="text-[10px] text-emerald-400"></div>
            </div>
        </div>

        <!-- Monitoring / Alerts -->
        <div class="bg-slate-900 border border-slate-800 p-6 rounded-xl shadow-2xl">
            <h2 class="text-xs font-bold text-slate-400 uppercase mb-4 tracking-tighter flex items-center gap-2">
                <span class="w-2 h-2 bg-rose-500 rounded-full"></span>
                Security Alerts / AI Monitoring
            </h2>
            <div class="h-48 overflow-y-auto space-y-2 font-sans text-[10px]" hx-get="/dev/alerts" hx-trigger="load, every 10s">
                <div class="p-2 bg-slate-950 border-l-2 border-slate-700 text-slate-500 italic">Lade Alarme...</div>
            </div>
        </div>

        <!-- Stage 4 Watchdog -->
        <div class="md:col-span-1 bg-slate-900 border border-slate-800 p-6 rounded-xl shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xs font-bold text-slate-400 uppercase tracking-tighter flex items-center gap-2">
                    <span class="w-2 h-2 bg-emerald-500 rounded-full animate-ping"></span>
                    Autonomy Stage 4: Indexing
                </h2>
            </div>
            <div class="bg-slate-950 p-4 rounded border border-slate-800 font-sans text-xs">
                <div class="flex justify-between">
                    <span class="text-slate-500">Status:</span>
                    <span class="text-emerald-400 font-bold">VEC STORED</span>
                </div>
            </div>
        </div>

        <!-- NEW: P2P Mesh Section -->
        <div class="md:col-span-1 bg-slate-900 border border-slate-800 p-6 rounded-xl shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xs font-bold text-indigo-400 uppercase tracking-tighter flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" stroke-width="2"></path></svg>
                    Local Mesh (P2P)
                </h2>
                <span class="text-[9px] text-indigo-500 bg-indigo-500/10 px-2 py-0.5 rounded">SCANNING</span>
            </div>
            <div class="space-y-2">
                <div class="p-2 bg-slate-950 rounded border border-indigo-900/30 flex justify-between items-center">
                    <span class="text-[10px] text-slate-300">TABLET-MASTER-01</span>
                    <span class="text-[9px] text-emerald-500 font-bold uppercase">Paired</span>
                </div>
                <div class="p-2 bg-slate-950 rounded border border-slate-800 flex justify-between items-center opacity-50">
                    <span class="text-[10px] text-slate-500">LAPTOP-OFFICE-B</span>
                    <button class="text-[9px] text-indigo-400 hover:text-white uppercase font-bold transition-all">Pair Now</button>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-12 text-center">
        <a href="/" class="text-[9px] text-slate-600 hover:text-white uppercase tracking-[0.3em] underline transition-all">Exit Secure Session</a>
    </div>
</body>
</html>
