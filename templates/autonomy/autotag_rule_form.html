<div class="space-y-4">
  {% if read_only %}
  <div class="rounded-xl border px-3 py-2 text-sm" style="border-color:#f59e0b;background:#fffbeb;color:#92400e;">
    Read-only mode: Regel-Änderungen sind deaktiviert.
  </div>
  {% endif %}

  <div class="flex items-center justify-between gap-2">
    <h1 class="text-xl font-bold">Neue Auto-Tagging Regel</h1>
    <a class="btn-outline rounded-xl px-3 py-2 text-sm" href="/autonomy/autotag/rules">Zurück</a>
  </div>

  <div id="autotagErrors"></div>

  <form class="card p-4 space-y-3" method="post" action="/autonomy/autotag/rules/create">
    <div class="grid md:grid-cols-3 gap-3">
      <label class="block text-sm">
        <span class="muted">Regelname</span>
        <input class="input mt-1 w-full" type="text" name="name" maxlength="80" required>
      </label>
      <label class="block text-sm">
        <span class="muted">Priorität</span>
        <input class="input mt-1 w-full" type="number" name="priority" min="-100" max="100" value="{{ defaults.priority if defaults else 0 }}">
      </label>
      <label class="inline-flex items-center gap-2 text-sm mt-6">
        <input type="checkbox" name="enabled" value="1" checked>
        Aktiv
      </label>
    </div>

    <div class="border-t pt-3" style="border-color:var(--border)">
      <h2 class="font-semibold text-sm mb-2">Bedingungen (AND)</h2>
      <div class="grid md:grid-cols-3 gap-3">
        <label class="block text-sm">
          <span class="muted">Dateiname-Glob</span>
          <input class="input mt-1 w-full" type="text" name="filename_glob" placeholder="*rechnung*">
        </label>
        <label class="block text-sm">
          <span class="muted">Erweiterungen</span>
          <select class="input mt-1 w-full" name="ext_in" multiple size="4">
            <option value="pdf">pdf</option>
            <option value="txt">txt</option>
            <option value="md">md</option>
            <option value="png">png</option>
            <option value="jpg">jpg</option>
            <option value="jpeg">jpeg</option>
            <option value="tiff">tiff</option>
            <option value="eml">eml</option>
            <option value="ics">ics</option>
          </select>
        </label>
        <label class="block text-sm">
          <span class="muted">DocType Token</span>
          <input class="input mt-1 w-full" type="text" name="doctype_token" maxlength="32" placeholder="invoice">
        </label>
      </div>
    </div>

    <div class="border-t pt-3" style="border-color:var(--border)">
      <h2 class="font-semibold text-sm mb-2">Aktionen</h2>
      <div class="grid md:grid-cols-3 gap-3">
        <label class="block text-sm">
          <span class="muted">Tag hinzufügen (bis 3)</span>
          <select class="input mt-1 w-full" name="add_tag" multiple size="5">
            {% for t in all_tags %}
            <option value="{{ t.name }}">{{ t.name }}</option>
            {% endfor %}
          </select>
        </label>
        <label class="block text-sm">
          <span class="muted">Setze DocType</span>
          <input class="input mt-1 w-full" type="text" name="set_doctype_token" maxlength="32" placeholder="invoice">
        </label>
        <label class="block text-sm">
          <span class="muted">Setze Correspondent</span>
          <input class="input mt-1 w-full" type="text" name="set_correspondent_token" maxlength="32" placeholder="kd-123">
        </label>
      </div>
    </div>

    <div class="pt-1">
      <button class="btn px-3 py-2" type="submit" {% if read_only %}disabled{% endif %}>
        Regel speichern
      </button>
    </div>
  </form>
</div>
