<div class="space-y-4">
  {% if read_only %}
  <div class="rounded-xl border px-3 py-2 text-sm" style="border-color:#f59e0b;background:#fffbeb;color:#92400e;">
    Read-only mode: Auto-Tagging-Regeln sind deaktiviert.
  </div>
  {% endif %}

  <div class="flex items-center justify-between gap-2">
    <h1 class="text-xl font-bold">Auto-Tagging Regeln</h1>
    <div class="flex items-center gap-2">
      <a class="btn-outline rounded-xl px-3 py-2 text-sm" href="/tags">Tags</a>
      <a class="btn-outline rounded-xl px-3 py-2 text-sm" href="/autonomy/autotag/rules/new">Neue Regel</a>
    </div>
  </div>

  <div class="card overflow-hidden">
    <table class="w-full text-sm">
      <thead>
        <tr class="border-b" style="border-color:var(--border)">
          <th class="text-left px-3 py-2">Name</th>
          <th class="text-left px-3 py-2">Priorität</th>
          <th class="text-left px-3 py-2">Bedingungen</th>
          <th class="text-left px-3 py-2">Aktionen</th>
          <th class="text-left px-3 py-2">Status</th>
          <th class="text-left px-3 py-2">Aktionen</th>
        </tr>
      </thead>
      <tbody>
        {% for rule in rules %}
        <tr class="border-b" style="border-color:var(--border)">
          <td class="px-3 py-2">{{ rule.name }}</td>
          <td class="px-3 py-2">{{ rule.priority }}</td>
          <td class="px-3 py-2">{{ (rule.condition_types or [])|join(", ") or "-" }}</td>
          <td class="px-3 py-2">{{ (rule.action_types or [])|join(", ") or "-" }}</td>
          <td class="px-3 py-2">{{ "aktiv" if rule.enabled else "deaktiviert" }}</td>
          <td class="px-3 py-2">
            <div class="flex items-center gap-2">
              <form method="post" action="/autonomy/autotag/rules/{{ rule.id }}/toggle">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="enabled" value="{{ 0 if rule.enabled else 1 }}">
                <button class="btn-outline px-2 py-1 text-xs" type="submit" {% if read_only %}disabled{% endif %}>
                  {{ "Deaktivieren" if rule.enabled else "Aktivieren" }}
                </button>
              </form>
              <form method="post" action="/autonomy/autotag/rules/{{ rule.id }}/delete">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button class="btn-outline px-2 py-1 text-xs" type="submit" {% if read_only %}disabled{% endif %}>
                  Löschen
                </button>
              </form>
            </div>
          </td>
        </tr>
        {% else %}
        <tr><td class="px-3 py-3 muted" colspan="6">Keine Regeln vorhanden.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
