<div class="space-y-4">
  <div class="flex items-center justify-between">
    <h1 class="text-xl font-semibold">Knowledge · E-Mail Upload (.eml)</h1>
    <a class="btn-outline rounded-xl px-3 py-2 text-sm" href="/knowledge">Zur Suche</a>
  </div>

  <div class="card p-3 text-sm">
    Max Upload: {{ (max_eml_bytes // (1024 * 1024)) }} MB · Quelle: E-Mail · Redaction aktiv
  </div>

  {% if read_only %}
  <div class="card p-3 text-sm" style="border-color:#f59e0b">Read-only mode aktiv. Schreibaktionen sind deaktiviert.</div>
  {% endif %}

  {% if not policy.allow_email %}
  <div class="card p-3 text-sm" style="border-color:#f59e0b">
    E-Mail Quelle ist deaktiviert. Aktiviere sie zuerst unter <a class="underline" href="/knowledge/settings">Knowledge Settings</a>.
  </div>
  {% endif %}

  {% include 'knowledge/partials/_email_upload_form.html' %}

  <div id="emailUploadResult"></div>

  <div class="card overflow-hidden">
    <table class="w-full text-sm">
      <thead>
        <tr class="border-b" style="border-color:var(--border)">
          <th class="text-left px-3 py-2">Zeit</th>
          <th class="text-left px-3 py-2">Betreff (redacted)</th>
          <th class="text-left px-3 py-2">From Domain</th>
          <th class="text-left px-3 py-2">Attachments</th>
          <th class="text-left px-3 py-2">SHA Prefix</th>
        </tr>
      </thead>
      <tbody>
        {% for row in emails %}
        <tr class="border-b" style="border-color:var(--border)">
          <td class="px-3 py-2">{{ row.created_at or '-' }}</td>
          <td class="px-3 py-2">{{ row.subject_redacted or '(no subject)' }}</td>
          <td class="px-3 py-2">{{ row.from_domain or '-' }}</td>
          <td class="px-3 py-2">{{ 'ja' if row.has_attachments else 'nein' }}</td>
          <td class="px-3 py-2">{{ (row.content_sha256 or '')[:12] }}</td>
        </tr>
        {% else %}
        <tr><td class="px-3 py-3 muted" colspan="5">Noch keine E-Mails ingestiert.</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="flex items-center justify-between px-3 py-2 text-xs muted">
      <div>Seite {{ page }} · {{ total }} gesamt</div>
      <div class="flex gap-2">
        {% if page > 1 %}
        <a class="btn-outline px-2 py-1" href="/knowledge/email/upload?page={{ page - 1 }}&page_size={{ page_size }}">Zurück</a>
        {% endif %}
        {% if has_more %}
        <a class="btn-outline px-2 py-1" href="/knowledge/email/upload?page={{ page + 1 }}&page_size={{ page_size }}">Weiter</a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
