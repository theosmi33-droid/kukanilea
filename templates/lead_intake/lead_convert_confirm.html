<div class="space-y-4">
  <div class="flex items-center justify-between">
    <h1 class="text-xl font-semibold">Lead in Deal/Quote umwandeln</h1>
    <a class="btn-outline px-3 py-2 text-sm" href="/leads/{{ lead.id }}">Zurück</a>
  </div>

  {% if read_only %}
  <div class="rounded-xl border border-rose-400/40 bg-rose-500/10 p-3 text-sm">
    Read-only mode aktiv. Schreibaktionen sind deaktiviert.
  </div>
  {% endif %}

  {% set locked_by_other = claim and claim.active and claim.claimed_by != current_user_id %}
  {% if locked_by_other %}
  <div class="rounded-xl border border-amber-400/40 bg-amber-500/10 p-3 text-sm">
    Dieser Lead ist aktuell von {{ claim.claimed_by }} geclaimt bis {{ claim.claimed_until }}.
  </div>
  {% endif %}

  <div class="card p-4 text-sm grid gap-2 md:grid-cols-2">
    <div><span class="opacity-70">Lead-ID:</span> {{ lead.id }}</div>
    <div><span class="opacity-70">Status:</span> {{ lead.status }}</div>
    <div><span class="opacity-70">Quelle:</span> {{ lead.source }}</div>
    <div><span class="opacity-70">Kunde verknüpft:</span> {{ 'ja' if lead.customer_id else 'nein' }}</div>
  </div>

  <div class="card p-4 space-y-3">
    <p class="text-sm opacity-80">
      Keine stille PII-Übernahme: Standardmäßig werden nur sichere Platzhalter verwendet.
      Du kannst einzelne Felder explizit aktivieren.
    </p>

    <form method="post" action="/leads/{{ lead.id }}/convert" class="grid gap-3">
      <div class="grid gap-3 md:grid-cols-2">
        <label class="grid gap-1 text-sm">
          Deal-Titel (optional)
          <input class="input px-3 py-2 text-sm" type="text" name="deal_title" maxlength="200" placeholder="z. B. Lead {{ lead.id[:8] }}" {% if read_only or locked_by_other %}disabled{% endif %}>
        </label>
        <label class="grid gap-1 text-sm">
          Kundenname (nur falls kein Kunde verknüpft)
          <input class="input px-3 py-2 text-sm" type="text" name="customer_name" maxlength="200" placeholder="Optional" {% if read_only or locked_by_other %}disabled{% endif %}>
        </label>
      </div>

      <label class="text-sm flex items-center gap-2">
        <input type="checkbox" name="use_subject_title" value="1" {% if read_only or locked_by_other %}disabled{% endif %}>
        Lead-Betreff explizit als Deal-Titel verwenden
      </label>
      <label class="text-sm flex items-center gap-2">
        <input type="checkbox" name="use_contact_name" value="1" {% if read_only or locked_by_other %}disabled{% endif %}>
        Kontaktname explizit als Kundenname verwenden (nur wenn nötig)
      </label>

      <button class="btn-primary px-3 py-2 text-sm" type="submit" {% if read_only or locked_by_other %}disabled{% endif %}>
        Deal + Quote-Entwurf erstellen
      </button>
    </form>
  </div>
</div>
