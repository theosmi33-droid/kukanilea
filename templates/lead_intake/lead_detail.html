<div class="space-y-4">
  <div class="flex items-center justify-between">
    <h1 class="text-xl font-semibold">Lead · {{ lead.subject or lead.id }}</h1>
    <a class="btn-outline px-3 py-2 text-sm" href="/leads/inbox">Zurück</a>
  </div>

  {% if read_only %}
  <div class="rounded-xl border border-rose-400/40 bg-rose-500/10 p-3 text-sm">
    Read-only mode aktiv. Schreibaktionen sind deaktiviert.
  </div>
  {% endif %}

  <div class="card p-4 grid gap-2 md:grid-cols-3 text-sm">
    <div><span class="opacity-70">Status:</span> <span id="leadStatusWrap" hx-get="/leads/_status/{{ lead.id }}" hx-trigger="load" hx-swap="innerHTML"></span></div>
    <div><span class="opacity-70">Quelle:</span> {{ lead.source }}</div>
    <div><span class="opacity-70">Kontakt:</span> {{ lead.contact_name or '-' }}</div>
    <div class="md:col-span-3"><span class="opacity-70">Betreff:</span> {{ lead.subject or '-' }}</div>
  </div>

  <div class="grid gap-4 md:grid-cols-2">
    <div class="card p-4 space-y-3">
      <h2 class="font-semibold">Aktionen</h2>
      <form method="post" action="/leads/{{ lead.id }}/status" class="grid gap-2">
        <select class="input px-3 py-2 text-sm" name="status" {% if read_only %}disabled{% endif %}>
          {% for s in ['new','contacted','qualified','lost','won'] %}
          <option value="{{ s }}" {% if lead.status==s %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
        <button class="btn-primary px-3 py-2 text-sm" type="submit" {% if read_only %}disabled{% endif %}>Status speichern</button>
      </form>

      <form method="post" action="/leads/{{ lead.id }}/note" class="grid gap-2">
        <textarea class="input px-3 py-2 text-sm" rows="3" name="note_text" placeholder="Neue Notiz" {% if read_only %}disabled{% endif %}></textarea>
        <button class="btn-outline px-3 py-2 text-sm" type="submit" {% if read_only %}disabled{% endif %}>Notiz hinzufügen</button>
      </form>

      <form method="post" action="/leads/{{ lead.id }}/call-log" class="grid gap-2 md:grid-cols-2">
        <input class="input px-3 py-2 text-sm" type="text" name="caller_name" placeholder="Anrufer" {% if read_only %}disabled{% endif %}>
        <input class="input px-3 py-2 text-sm" type="text" name="caller_phone" placeholder="Telefon" {% if read_only %}disabled{% endif %}>
        <select class="input px-3 py-2 text-sm" name="direction" {% if read_only %}disabled{% endif %}>
          <option value="inbound">inbound</option>
          <option value="outbound">outbound</option>
        </select>
        <input class="input px-3 py-2 text-sm" type="number" min="0" name="duration_seconds" placeholder="Dauer (s)" {% if read_only %}disabled{% endif %}>
        <textarea class="input px-3 py-2 text-sm md:col-span-2" rows="2" name="notes" placeholder="Notiz" {% if read_only %}disabled{% endif %}></textarea>
        <button class="btn-outline px-3 py-2 text-sm md:col-span-2" type="submit" {% if read_only %}disabled{% endif %}>Call-Log speichern</button>
      </form>

      <form method="post" action="/leads/{{ lead.id }}/appointment" class="grid gap-2">
        <input class="input px-3 py-2 text-sm" type="text" name="requested_date" placeholder="ISO-Datum, z.B. 2026-02-14T10:00:00+00:00" {% if read_only %}disabled{% endif %}>
        <textarea class="input px-3 py-2 text-sm" rows="2" name="notes" placeholder="Termin-Notiz" {% if read_only %}disabled{% endif %}></textarea>
        <button class="btn-outline px-3 py-2 text-sm" type="submit" {% if read_only %}disabled{% endif %}>Termin anlegen</button>
      </form>
    </div>

    <div id="leadTimeline" class="space-y-3" hx-get="/leads/_timeline/{{ lead.id }}" hx-trigger="load" hx-swap="innerHTML"></div>
  </div>
</div>
