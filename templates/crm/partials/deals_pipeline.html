<div class="grid gap-3 md:grid-cols-2 xl:grid-cols-3">
  {% for stage in grouped.keys()|list|sort %}
  <div class="card p-3">
    <div class="font-semibold mb-2">{{ stage|upper }}</div>
    <div class="space-y-2">
      {% for d in grouped[stage] %}
      <div class="border rounded-lg px-3 py-2" style="border-color:var(--border)">
        <div class="font-medium">{{ d.title }}</div>
        <div class="text-xs muted">{{ d.customer_name or d.customer_id }} Â· {{ d.value_text }}</div>
        <div class="mt-2">
          <select class="input px-2 py-1 text-xs"
                  {% if read_only %}disabled{% endif %}
                  hx-put="/api/deals/{{ d.id }}/stage"
                  hx-trigger="change"
                  hx-headers='{"Content-Type":"application/json"}'
                  hx-vals='js:{"stage": event.target.value}'
                  hx-swap="none">
            {% for st in ['lead','qualified','proposal','negotiation','won','lost'] %}
            <option value="{{ st }}" {% if d.stage==st %}selected{% endif %}>{{ st }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      {% else %}
      <div class="muted text-sm">Keine Deals.</div>
      {% endfor %}
    </div>
  </div>
  {% endfor %}
</div>
